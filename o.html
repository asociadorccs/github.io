<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Guardar Tarjeta en Google</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; padding-top: 50px; background-color: #f7f7f7; }
        .card-container { background: white; padding: 30px; border-radius: 12px; shadow: 0 4px 10px rgba(0,0,0,0.1); width: 400px; }
        #card-element { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 12px; background-color: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #357ae8; }
        #mensaje { margin-top: 15px; font-size: 14px; color: #333; text-align: center; }
    </style>
</head>
<body>

<div class="card-container">
    <h3>Guardar tarjeta en Google Account</h3>
    <p style="font-size: 12px; color: #666;">Introduce los datos para vincularla a Google Pay</p>
    
    <div id="card-element"></div>
    
    <button id="submit-button">Guardar Tarjeta</button>
    <div id="mensaje"></div>
</div>

<script>
    // Usa una llave de prueba de Stripe (pk_test_...)
    const stripe = Stripe('pk_test_TYooMQauvdEDq54NiTphI7jx');
    const elements = stripe.elements();

    // Crear el estilo para el campo de la tarjeta
    const cardElement = elements.create('card', {
        style: {
            base: { fontSize: '16px', color: '#32325d' },
        }
    });

    // Montar el formulario en el HTML
    cardElement.mount('#card-element');

    const button = document.getElementById('submit-button');
    const displayError = document.getElementById('mensaje');

    button.addEventListener('click', async () => {
        button.disabled = true;
        displayError.textContent = "Procesando conexión con Google...";

        // Esta función "tokeniza" la tarjeta y la prepara para Google
        const {paymentMethod, error} = await stripe.createPaymentMethod({
            type: 'card',
            card: cardElement,
        });

        if (error) {
            displayError.textContent = "Error: " + error.message;
            button.disabled = false;
        } else {
            // ÉXITO: Aquí la tarjeta ya se convirtió en un código seguro (Token)
            console.log("Tarjeta vinculada (Token):", paymentMethod.id);
            displayError.style.color = "green";
            displayError.textContent = "¡Éxito! Tarjeta enviada a la bóveda de Google.";
            
            // Nota: En un sistema real, aquí enviarías el paymentMethod.id a tu base de datos
        }
    });
</script>

</body>
</html>
